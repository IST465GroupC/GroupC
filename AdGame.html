<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Test</title>
    <script>


        var targetX = 0, targetY = 0, shots = 0, hits = 0, accuracy = 0;

        window.requestAnimFrame = (function () {
            return window.requestAnimationFrame
        })();

        function Virus(mapX, mapY, x, y, canvas) {
            this.x = Math.floor((Math.random() * 200) + 1); //determines a random x-coordinate for the virus image
            this.y = Math.floor((Math.random() * 200) + 1); //determines a random y-coordinate for the virus image
            this.height = 50; //determines the height of the virus image
            this.width = 50; //determines the width of the virus image
            this.drctn = Math.floor((Math.random() * 359)); //determines the direction the virus will move in
            this.spd = 5; //determines the speed the virus moves at
            this.canvas = canvas; //assigns the canvas to keep virus images within
            this.hit = false;

            this.draw = function (ctx, sprite) {
                if (this.hit === false) {
                    ctx.drawImage(sprite, 0, 0,
                         300, 300,
                         this.getX(), this.getY(),
                         this.getWidth(), this.getHeight());
                }
                return this;
            };
            this.move = function () {
                this.x += Math.cos(this.toRad(this.drctn)) * this.spd;
                this.y -= Math.sin(this.toRad(this.drctn)) * this.spd;

                if (this.drctn < 0) {
                    this.drctn += 360;
                } else if (this.drctn > 360) {
                    this.drctn -= 360;
                }
            };

            this.toRad = function (v) {
                return v * 3.14 / 180;
            };

            this.checkBoundaryCollision = function () {
                if (this.x + this.width > this.canvas.width ||
               this.x < 0) {
                    this.drctn = 2 * 0 - this.drctn - 180;
                } else if (this.y < 0 ||
                 this.y + this.height > this.canvas.height) {
                    this.drctn = 2 * 90 - this.drctn - 180;
                }
            };

            this.getX = function () {
                return this.x;
            };

            this.getY = function () {
                return this.y;
            };

            this.getWidth = function () {
                return this.width;
            };

            this.getHeight = function () {
                return this.height;
            };

            this.setHit = function () {
                this.hit = true;
            };

            this.getHit = function () {
                return this.hit;
            };
        };


        function Explosion(x, y) {
            this.x = x;
            this.y = y;
            this.drawing = true;
            this.explosionFrame = 10;
            this.width = 100;
            this.height = 100;

            this.checkHits = function (Viruses) {
                if (this.drawing === false) {
                    return 0;
                }

                var centreX = (this.x - 75) + (this.width / 2),
                 centreY = (this.y - 75) + (this.height / 2),
                 hits = 0;

                for (i = 0; i < Viruses.length; i++) {
                    if (centreX > Viruses[i].getX() &&
                         centreX < Viruses[i].getX() + Viruses[i].getWidth() &&
                         centreY > Viruses[i].getY() &&
                         centreY < Viruses[i].getY() + Viruses[i].getHeight() &&
                         Viruses[i].getHit() === false) {
                        Viruses[i].setHit();
                        hits++;
                    }
                }

                return hits;
            };

            this.draw = function (ctx, explosion) {
                if (this.drawing === false) {
                    return this;
                }
                try {
                    if (this.explosionFrame-- <= 0) {
                        this.drawing = false;
                    }
                    //Draw explosion
                    ctx.drawImage(explosion, ((this.explosionFrame % 10) - 1) * 65, 0,
                         65, 65,
                         this.x - 75, this.y - 75,
                         this.width, this.height);
                }
                catch (e) {
                }
                return this;
            };
        };

        var explosions = [], ctx, canvas, sprites = [], sprite = null;

        function loadSprite() {
            sprite = new Image();
            sprite.src = 'ComputerVirus6.png';

            target = new Image();
            target.src = 'Virus2.png';

            explosion = new Image();
            explosion.src = 'Images/explosion.png';
        }

        function init() {

            canvas = document.getElementById('canvas');
            ctx = canvas.getContext('2d');
            canvas.onmousemove = moveTarget;
            canvas.onclick = fire;
            resizeCanvas();
            loadSprite();
            var i;
            for (i = 0; i < 3; i++) 
            {
                sprites.push(new Virus(50, 50,
              Math.floor((Math.random() * canvas.width) + 1),
              Math.floor((Math.random() * canvas.height) + 1),
              canvas));
            } //loop used to create multiple viruses
        }

        //Function used to continuously clear the canvas
        function clearCanvas() {

            ctx.fillStyle = "white";
            ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
        }

        //Function to play the game
        function start() {
            clearCanvas();

            for (i = 0; i < sprites.length; i++) {
                sprites[i].draw(ctx, sprite).move();
                sprites[i].checkBoundaryCollision();
            }

            for (i = 0; i < explosions.length; i++) {
                explosions[i].draw(ctx, explosion);
                hits += explosions[i].checkHits(sprites);
            }

            if (hits < 3) {
                accuracy = Math.round((hits / shots) * 100);
                ctx.fillStyle = "#cfcfcf";
                ctx.font = "bold 16pt Arial";
                ctx.fillText("Shots: " + shots + " Hits: " + hits +
                     " Accuracy: " + accuracy + "%", 10, 30);
            }
            if (hits === 3) {
                ctx.fillStyle = "#cfcfcf";
                ctx.font = "bold 48pt Arial";
                ctx.fillText("Game Over!", 50, 200);
                ctx.fillStyle = "#cfcfcf";
                ctx.font = "bold 12pt Arial";
                ctx.fillText("Fill out our form above to learn more about programming!", 10, 250);
            }
            if (shots === 15) 
            {
                window.location.href = "http://groupc.azurewebsites.net/CSU-CS-FORM.html";
            }

            //Draw target
            ctx.drawImage(target, 0, 0, 450, 400,
                 targetX - 75, targetY - 75,
                 100, 100);

            requestAnimFrame(start);
        }

        function resizeCanvas() {
            ctx.canvas.width = 500;
            ctx.canvas.height = 400;
        }

        //Controls your mouse and target alignment on the page
        function moveTarget(e) {
            e = e;
            targetX = e.pageX + 50;
            targetY = e.pageY;
        }

        function fire() {
            explosions.push(new Explosion(targetX, targetY));
            shots++;
        }

        // resize the canvas to fill browser window dynamically
        window.addEventListener('resize', resizeCanvas, false);

        // Start the process
        window.onload = function () {
            init();
            start();
        };

    </script>
    <style>
	#canvas {
	    position: absolute; 
        top:50px;
        left:0px;
	    cursor: none;
	    background-color: white;
	}
    </style>
</head>
<body>
    <canvas id="canvas" width="500" height="400"></canvas>
    <p>Want to learn how to program?<a href="CSU-CS-FORM.html">Apply here for more information.</a></p>
    
</body>
</html>